"use strict";angular.module("animates.angular-timeline",[]).directive("animatesTimelinepoint",function($document){return{restrict:"E",template:"",scope:{point:"=",eventData:"=",pointMove:"&",pointClick:"&",multiplepointeventSelected:"&"},link:{pre:function($scope,element){element.css({left:$scope.point.tick+"px"})},post:function($scope,element){function elementMove(event){var newTick=event.pageX-x;newTick>0&&(point.tick=newTick,element.css({left:newTick+"px"}))}function elementMoveEnd(){$document.unbind("mousemove",elementMove),$document.unbind("mouseup",elementMoveEnd),element.css({"z-index":originalZIndex}),$scope.pointMove({pointData:point.data,newTick:point.tick})}var x,originalZIndex,point=$scope.point;element.on("click",function(){$scope.pointClick({eventData:$scope.eventData,pointData:point.data}),$scope.multiplepointeventSelected({eventData:$scope.eventData})}),element.on("mouseover",function(){element.css({cursor:"move"})}),element.on("mousedown",function(event){event.preventDefault(),x=event.pageX-point.tick,originalZIndex=element.css("z-index"),element.css({"z-index":1e3}),$document.on("mousemove",elementMove),$document.on("mouseup",elementMoveEnd)})}}}}).directive("animatesTimelineevent",function($document){return{restrict:"E",template:"<span class='left'></span><span class='center'></span><span class='right'></span>",scope:{evt:"=",eventStartchange:"&",eventDurationchange:"&",eventClick:"&"},link:function($scope,element){function elementMove(event){var newStart=event.pageX-x;newStart>0&&(evt.start=newStart,element.css({left:newStart+"px"}))}function elementMoveEnd(){$document.unbind("mousemove",elementMove),$document.unbind("mouseup",elementMoveEnd),element.css({"z-index":originalZIndex}),$scope.eventStartchange({eventData:evt.data,newStartTick:evt.start})}function elementExpandFront(event){var newStart=event.pageX-x,newDuration=originalEndPosition-newStart;newStart>0&&newDuration>0&&(evt.duration=newDuration,evt.start=newStart,element.css({left:newStart+"px",width:newDuration+"px"}),centerElement.css({width:newDuration-border+"px"}))}function elementExpandFrontEnd(){$document.unbind("mousemove",elementExpandFront),$document.unbind("mouseup",elementExpandFrontEnd),element.css({"z-index":originalZIndex}),$scope.eventStartchange({eventData:evt.data,newStartTick:evt.start}),$scope.eventDurationchange({eventData:evt.data,newDuration:evt.duration})}function elementExpandBack(event){var newStart=event.pageX-x,newDuration=newStart-evt.start+originalDuration;newDuration>0&&(evt.duration=newDuration,element.css({width:newDuration+"px"}),centerElement.css({width:newDuration-border+"px"}))}function elementExpandBackEnd(){$document.unbind("mousemove",elementExpandBack),$document.unbind("mouseup",elementExpandBackEnd),element.css({"z-index":originalZIndex}),$scope.eventDurationchange({eventData:$scope.evt.data,newDuration:evt.duration})}var x,originalDuration,originalZIndex,originalEndPosition,evt=$scope.evt,leftElement=angular.element(element[0].querySelector(".left")),centerElement=angular.element(element[0].querySelector(".center")),rightElement=angular.element(element[0].querySelector(".right")),border=30;element.css({left:evt.start+"px",width:evt.duration+"px"}),centerElement.css({width:evt.duration-border+"px"}),element.addClass(evt.class),element.on("click",function(){$scope.eventClick({eventData:evt.data})}),leftElement.on("mouseover",function(){element.css({cursor:"ew-resize"})}),rightElement.on("mouseover",function(){element.css({cursor:"ew-resize"})}),centerElement.on("mouseover",function(){element.css({cursor:"move"})}),leftElement.on("mousedown",function(event){event.preventDefault(),x=event.pageX-evt.start,originalDuration=evt.duration,originalZIndex=element.css("z-index"),originalEndPosition=evt.start+evt.duration,element.css({"z-index":1e3}),$document.on("mousemove",elementExpandFront),$document.on("mouseup",elementExpandFrontEnd)}),rightElement.on("mousedown",function(event){event.preventDefault(),x=event.pageX-evt.start,originalDuration=evt.duration,originalZIndex=element.css("z-index"),element.css({"z-index":1e3}),$document.on("mousemove",elementExpandBack),$document.on("mouseup",elementExpandBackEnd)}),centerElement.on("mousedown",function(event){event.preventDefault(),x=event.pageX-evt.start,originalDuration=evt.duration,originalZIndex=element.css("z-index"),element.css({"z-index":1e3}),$document.on("mousemove",elementMove),$document.on("mouseup",elementMoveEnd)})}}}).directive("animatesTimeline",function(){return{restrict:"E",template:"<div class='timeline-content'><animates-timelinepoint class='timeline-point' ng-repeat='point in line.points' point='point' event-data='line.data' point-move='internalPointMove(pointData, newTick)' point-click='internalPointClick(pointData)' multiplepointevent-selected='internalMultiplePointEventSelected(eventData)' > </animates-timelinepoint><animates-timelineevent class='timeline-event' ng-repeat='event in line.events' evt='event' event-startchange='internalEventStartChange(eventData, newStartTick)' event-durationchange='internalEventDurationChange(eventData, newDuration)' event-click='internalEventClick(eventData)' > </animates-timelineevent></div>",scope:{line:"=data",timelineData:"=",eventStartchange:"&",eventDurationchange:"&",eventClick:"&",pointMove:"&",pointClick:"&",multiplepointeventSelected:"&"},controller:function($scope){$scope.internalEventStartChange=function(eventData,newStartTick){$scope.eventStartchange&&$scope.eventStartchange({timelineData:$scope.timelineData,eventData:eventData,newStartTick:newStartTick})},$scope.internalEventDurationChange=function(eventData,newDuration){$scope.eventDurationchange&&$scope.eventDurationchange({timelineData:$scope.timelineData,eventData:eventData,newDuration:newDuration})},$scope.internalEventClick=function(eventData){$scope.eventClick&&$scope.eventClick({timelineData:$scope.timelineData,eventData:eventData})},$scope.internalPointMove=function(pointData,newTick){$scope.pointMove&&$scope.pointMove({timelineData:$scope.timelineData,pointData:pointData,newTick:newTick})},$scope.internalPointClick=function(pointData){$scope.pointClick&&$scope.pointClick({timelineData:$scope.timelineData,pointData:pointData})},$scope.internalMultiplePointEventSelected=function(eventData){$scope.multiplepointeventSelected&&$scope.multiplepointeventSelected({timelineData:$scope.timelineData,eventData:eventData})}},link:function($scope,element){$scope.line.points&&element.addClass("points"),$scope.line.events&&element.addClass("events")}}}).directive("animatesTimelines",function($timeout,$document){return{restrict:"E",template:"<div class='timelines-tick-navigator'><div class='tickHandlerHeader' ></div><div class='tickHandlerContainer'><div class='tickHandler' style='left:{{tick-5}}px'></div></div></div></div><div class='timelines-group'><div class='timelinesHeaders'><div ng-repeat='timeline in data' class='timeline-part timeline-header' data='timeline.data' rel='{{$index}}'><span class='timeline-header-track' title='timeline.name' >{{timeline.name}}</span></div></div><div class='timelinesContainer'><div class='verticalLine' style='left:{{tick}}px'></div><div ng-repeat='timeline in data' class='timeline-part timeline' data='timeline.data'><div class='elementLinesContainer' rel='{{$index}}'><animates-timeline ng-repeat='line in timeline.lines' data='line' timeline-data='timeline.data' point-move='internalPointMove(timelineData, pointData, newTick)' point-click='internalPointClick(timelineData, pointData)' multiplepointevent-selected='internalMultiplePointEventSelected(timelineData, eventData)' event-startchange='internalEventStartChange(timelineData, eventData, newStartTick)' event-durationchange='internalEventDurationChange(timelineData, eventData, newDuration)' event-click='internalEventClick(timelineData, eventData)' > </animates-timeline></div></div></div></div>",scope:{data:"=",tick:"=",tickChange:"&",eventStartchange:"&",eventDurationchange:"&",eventClick:"&",pointMove:"&",pointClick:"&",multiplepointeventSelected:"&"},controller:function($scope){$scope.internalTickChange=function(){$scope.tickChange&&$scope.tickChange({tick:$scope.tick})},$scope.internalEventStartChange=function(timelineData,eventData,newStartTick){$scope.eventStartchange&&$scope.eventStartchange({timelineData:timelineData,eventData:eventData,newStartTick:newStartTick})},$scope.internalEventDurationChange=function(timelineData,eventData,newDuration){$scope.eventDurationchange&&$scope.eventDurationchange({timelineData:timelineData,eventData:eventData,newDuration:newDuration})},$scope.internalEventClick=function(timelineData,eventData){$scope.eventClick&&$scope.eventClick({timelineData:timelineData,eventData:eventData})},$scope.internalPointMove=function(timelineData,pointData,newTick){$scope.pointMove&&$scope.pointMove({timelineData:timelineData,pointData:pointData,newTick:newTick})},$scope.internalPointClick=function(timelineData,pointData){$scope.pointClick&&$scope.pointClick({timelineData:timelineData,pointData:pointData})},$scope.internalMultiplePointEventSelected=function(timelineData,eventData){$scope.multiplepointeventSelected&&$scope.multiplepointeventSelected({timelineData:timelineData,eventData:eventData})}},link:function($scope,element){function tickHandlerMove(event){var newTick=event.pageX-x;if(newTick>0){$scope.$apply(function(){$scope.tick=newTick});var delta=originalTick-newTick;(delta>5||-5>delta)&&(originalTick=newTick,$scope.internalTickChange())}}function tickHandlerMoveEnd(){$document.unbind("mousemove",tickHandlerMove),$document.unbind("mouseup",tickHandlerMoveEnd),originalTick!=$scope.tick&&$scope.internalTickChange()}$timeout(function(){angular.forEach(element[0].querySelectorAll(".elementLinesContainer"),function(timeline){var id=angular.element(timeline).attr("rel"),height=angular.element(timeline)[0].offsetHeight;element[0].querySelector('.timeline-header[rel="'+id+'"]').style.height=height-1+"px"})});var x,originalTick;element.on("mouseover",function(){element.css({cursor:"move"})}),element.on("mousedown",function(event){event.preventDefault(),x=event.pageX-$scope.tick,originalTick=$scope.tick,$document.on("mousemove",tickHandlerMove),$document.on("mouseup",tickHandlerMoveEnd)})}}});